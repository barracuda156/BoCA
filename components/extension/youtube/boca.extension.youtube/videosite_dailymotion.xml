<VideoSite>
  <name>Dailymotion</name>
  <version>1.0</version>
  <decoder>avconv-m4v_audio-dec</decoder>

  <script type="text/javascript">
    <![CDATA[
      function canHandleURL(URL) {
	if (URL.toLowerCase().match(/http:\/\/www.dailymotion.com\/video\/.*/)) return true;
	else									return false;
      }

      function getVideoURL(html) {
	var sequence = unescape((html.match(/var flashvars = {.*?"sequence":"(.*?)".*?};/), RegExp.$1));

	return (sequence.match(/"sdURL":"(.*?)"/), RegExp.$1).replace(/\\\//g, "/");
      }

      function queryMetadata(html) {
	var metadata = new Metadata();

	metadata.title	     = (html.match(/<meta property="og:title" content="(.*?)".*?\/>/) ? RegExp.$1 : null);
	metadata.description = (html.match(/<meta property="og:description" content="((?:.|\n|\r)*?)".*?\/>/) ? RegExp.$1 : null);

	metadata.date	     = (html.match(/<meta property="video:release_date" content="(.*?)T.*?".*?\/>/) ? RegExp.$1 : null);
	metadata.thumbnail   = (html.match(/<link rel="thumbnail" type="image\/jpeg" href="(.*?)" \/>/) ? "http://www.dailymotion.com" + RegExp.$1 : null);

	metadata.uploader    = (html.match(/<div class="user_container">(?:.|\n|\r)*?<img\s+alt="(.*?)" .*?\/>/) ? RegExp.$1 : null);

	return metadata;
      }
    ]]>
  </script>
</VideoSite>
