########## BoCA commands makefile ##########

CC = gcc
CCOPTS = -g0 -Wall -ffast-math -D__BOCA_COMPONENT_BUILD__ $(DEFINE) -I$(BOCA_PATH)/include
LD = gcc
LDOPTS = -L$(BOCA_PATH)/$(LIBDIR) -lsmooth -lboca -lstdc++ $(LIBS)

ifneq ($(EXCEPTION),True)
	CCOPTS += -fno-exceptions
endif

ifeq ($(BUILD_X64),True)
	CCOPTS += -march=nocona

	PACKER = mpress
	PACKER_OPTS = -q
else
	CCOPTS += -march=i586 -Os

	PACKER = upx
	PACKER_OPTS = --best -q
endif

ifeq ($(BUILD_WIN32),True)
	DLLEXT = .dll
else
	DLLEXT = .so
endif

all : $(BOCA_PATH)/$(BINDIR)/boca_$(TYPE)_$(TARGET).$(VERSION)$(DLLEXT)
	$(ALLCMD1)
	$(ALLCMD2)

$(BOCA_PATH)/$(BINDIR)/boca_$(TYPE)_$(TARGET).$(VERSION)$(DLLEXT) : $(OBJECTS)
	$(LD) --shared -o $@ $(OBJECTS) $(LDOPTS)
	strip --strip-all $@
#	$(PACKER) $(PACKER_OPTS) $@

clean :
	rm -f $(BOCA_PATH)/$(BINDIR)/boca_$(TYPE)_$(TARGET).$(VERSION)$(DLLEXT) $(OBJECTS)
	$(CLEANCMD1)
	$(CLEANCMD2)

.c.o:
	$(CC) $(CCOPTS) -c $< -o $@

.cpp.o:
	$(CC) $(CCOPTS) -c $< -o $@
